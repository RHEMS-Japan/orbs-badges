description: >
  Generate badges from the services of RHEMS BADGES.

parameters:
  ssh_key:
    type: string
    description: "fingerprints. (Required)"
  file_path:
    type: string
    default: ./README.md
    description: "path of README.md"
  user_name:
    type: string
    default: "Mr.badges"
    description: "GitHub user.name"
  user_email:
    type: string
    default: "badges@rhems-japan.co.jp"
    description: "GitHub user.email"

steps:
  - add_ssh_keys:
      fingerprints:
      - <<parameters.ssh_key>>
  - checkout
  - run:
      name: Readme update
      command: |
        sed -i -e "s#branch=.*\&cised=true#branch=<<parameters.branch>>\&cised=true#g"  << parameters.readme_path >>
        sed -i -e "s#update=.*\&cised=true\&#update=${TIME}\&cised=true\&#g"  << parameters.readme_path >>
  - run:
      name: git push
      command: |
        git config --global user.email << parameters.user_email >>
        git config --global user.name << parameters.user_name >>
        git add << parameters.readme_path >>
        git commit -m '[skip ci] << parameters.readme_path >> Update'
        git push origin $CIRCLE_BRANCH
